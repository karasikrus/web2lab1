<html>
<head>
    <title>Hello World</title>
    <meta charset="utf-8">

    <script src="handlebars-v4.3.1.js"></script>

    <script id="text-template" type="text/x-handlebars-template">
        city: <b>{{city}}</b>
    </script>
    <script id="loading-template" type="text/x-handlebars-template">
        <div> <b>грузится...</b></div>
    </script>

</head>
<body>

City input: <input id="city">
<button id="search-city">Погода!</button>

<hr>
<div id="result"></div>

<script>
    function show_city() {
        var city = document.getElementById('city').value;

        var source   = document.getElementById('text-template').innerHTML;
        var template = Handlebars.compile(source);
        var context = {city: city};
        var html    = template(context);

        document.getElementById('result').innerHTML = html;
    }

    const ApiKey = '4d7bab9a12e7e664eeadf2d29a195b1f';
    const ApiUrl = 'https://api.openweathermap.org/data/2.5/weather';
    async function getWeather(city) {
        console.log("aaa");
        let url = new URL(ApiUrl);
        console.log(url);
        url.searchParams.append('appid', ApiKey);
        url.searchParams.append('units', 'metric');
        url.searchParams.append('q', city);
        console.log(url);
        let response = await fetch(url);

        if (response.status === 200) {
            return await response.json();
        } else {
            await response.json()
                .then(json => Promise.reject(json))
        }
    }
    function showWeather(){
        let city = document.getElementById('city').value;

        let loadingSource = document.getElementById('loading-template').innerHTML;
        let loadingHtml = Handlebars.compile(loadingSource);
        document.getElementById('result').innerHTML = loadingHtml;
        console.log('eee');

        getWeather(city).then(wheather =>
            document.getElementById('result').innerHTML = wheather).catch(err =>
            document.getElementById('result').innerHTML = "ой");
    }

    document.getElementById('search-city').addEventListener('click', showWeather);
</script>


</body>
</html>
